# 📸 사진 업로드 - Google Drive 연동 설정

## 🎯 개요
고객이 업로드한 옥상 사진을 Google Drive에 자동 저장하고, 이메일로 사진 링크를 받습니다.

---

## 📋 **설정 단계 (5분)**

### **Step 1: Google Drive 폴더 만들기**

1. https://drive.google.com 접속 (alstj36382@gmail.com 계정)
2. 왼쪽 **+ 새로 만들기** → **폴더** 클릭
3. 폴더 이름: **"솔라코어_옥상사진"** 입력
4. **만들기** 클릭
5. 생성된 폴더를 **더블클릭**해서 열기
6. 주소창의 URL에서 **폴더 ID** 복사

```
https://drive.google.com/drive/folders/1abc123def456ghi789jkl
                                        ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
                                        이 부분이 폴더 ID입니다
```

예시: `1abc123def456ghi789jkl`

📋 **메모장에 복사해두세요!**

---

### **Step 2: Apps Script 코드 교체**

#### **2-1. Apps Script 열기**
1. Google Sheets → 확장 프로그램 → Apps Script
2. 기존 코드 **전체 삭제**

#### **2-2. 새 코드 붙여넣기**
프로젝트 폴더에 있는 **`apps-script-with-drive.js`** 파일 열기

또는 아래 코드 **전체 복사**:

```javascript
(여기에 apps-script-with-drive.js 내용이 들어갑니다)
```

Apps Script 에디터에 **붙여넣기**

#### **2-3. 폴더 ID 입력** ⚠️ **중요!**

코드 **12번째 줄** 찾기:
```javascript
var DRIVE_FOLDER_ID = "YOUR_FOLDER_ID_HERE";
```

**Step 1에서 복사한 폴더 ID**로 교체:
```javascript
var DRIVE_FOLDER_ID = "1abc123def456ghi789jkl";  // ← Step 1의 ID
```

#### **2-4. 이메일 확인**
6번째 줄:
```javascript
var ADMIN_EMAIL = "alstj36382@gmail.com";  // ← 올바른지 확인
```

#### **2-5. 저장**
- **Ctrl + S** (저장)

---

### **Step 3: 재배포**

기존에 배포했던 것을 업데이트해야 합니다.

#### **방법 1: 새 배포 (권장)**
1. 상단 **배포** → **새 배포**
2. ⚙️ 아이콘 → **웹 앱** 선택
3. 설정:
   - 다음 계정으로 실행: **나**
   - 액세스 권한: **모든 사용자** ⚠️
4. **배포** 클릭
5. 새 배포 URL 복사

**기존 URL과 다르면:**
- `js/main.js` 파일의 `GOOGLE_SCRIPT_URL`도 업데이트

#### **방법 2: 기존 배포 업데이트**
1. 상단 **배포** → **배포 관리**
2. 연필 아이콘 (편집) 클릭
3. **버전**: 새 버전 생성
4. **배포** 클릭
5. 기존 URL 그대로 사용 가능

---

### **Step 4: 테스트**

#### **4-1. Apps Script 테스트**
1. Apps Script 상단 함수 선택: **testPhotoForm**
2. **실행** (▶️) 클릭
3. 실행 완료 후:
   - Google Drive → "솔라코어_옥상사진" 폴더 열기
   - **테스트 이미지 파일** 있는지 확인
   - Gmail 확인 → 이메일에 **Google Drive 링크** 있는지 확인

#### **4-2. 웹사이트 테스트**
1. index.html 열기 (브라우저)
2. 사진 업로드 섹션으로 스크롤
3. 테스트 정보 입력:
   ```
   연락처: 010-1234-5678
   사진: 아무 이미지 파일 선택
   ```
4. **"사진 보내고 설치 가능 여부 확인하기"** 버튼 클릭
5. 확인:
   - ✅ 성공 메시지 표시
   - ✅ Google Drive 폴더에 사진 저장됨
   - ✅ Google Sheets에 데이터 + 링크 저장됨
   - ✅ Gmail에 사진 링크 포함된 이메일 수신

---

## 📊 **결과 확인 방법**

### **1. Google Sheets**
- "사진업로드" 시트에 새 컬럼 추가됨:
  ```
  | 연락처 | 파일이름 | 파일크기 | 제출시간 | 사진링크 |
  | 010-1234-5678 | rooftop.jpg | 2.5MB | 2024-11-21 15:30 | https://drive.google.com/... |
  ```
- **"사진링크"** 컬럼 클릭 → 사진 바로 확인!

### **2. Gmail**
이메일 내용:
```
📸 [솔라코어] 새로운 옥상 사진 업로드 - 010-1234-5678

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📸 사진 업로드 정보
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📞 연락처: 010-1234-5678
📁 파일 이름: rooftop.jpg
📦 파일 크기: 2.5MB

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📷 사진 보기 (Google Drive)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔗 사진 링크:
https://drive.google.com/file/d/...

※ 위 링크를 클릭하면 업로드된 사진을 바로 확인하실 수 있습니다.
```

### **3. Google Drive**
- "솔라코어_옥상사진" 폴더
- 파일 이름 형식: `20241121_153045_01012345678_rooftop.jpg`
  - 타임스탬프_연락처_원본파일명

---

## 🎯 **상담 프로세스 (개선됨!)**

```
1. 고객: 웹사이트에서 연락처 + 사진 업로드
   ↓
2. 시스템: Google Drive에 자동 저장
   ↓
3. 시스템: 이메일로 사진 링크 전송
   ↓
4. 상담사: 이메일 확인 → 링크 클릭 → 사진 확인
   ↓
5. 상담사: 사진 보고 설치 가능 여부 판단
   ↓
6. 상담사: 고객 전화 → 상담 진행
```

**장점:**
- ✅ 사진을 **즉시 확인** 가능
- ✅ 전화하기 전에 **미리 분석**
- ✅ 더 **전문적인 상담** 가능
- ✅ 시간 절약

---

## 🔧 **문제 해결**

### ❌ "폴더 ID가 설정되지 않았습니다" 에러
→ Apps Script 12번째 줄의 `DRIVE_FOLDER_ID` 확인

### ❌ 사진 업로드 실패
→ Drive API 권한 확인:
1. Apps Script → 서비스 (왼쪽 메뉴)
2. **Drive API** 추가 (이미 자동으로 활성화됨)

### ❌ 이메일에 링크가 없음
→ `sendPhotoEmail` 함수의 `driveFileUrl` 파라미터 확인

### ❌ 사진 링크 클릭 시 권한 오류
→ Drive 폴더 공유 설정:
1. "솔라코어_옥상사진" 폴더 우클릭
2. **공유** 클릭
3. **링크가 있는 모든 사용자** 선택 (선택사항, 더 편함)

---

## 📱 **파일 크기 제한**

- **최대 10MB** (웹사이트에서 검증)
- 대부분의 스마트폰 사진은 2~5MB
- 10MB 이상 파일은 자동으로 거부됨

---

## 💾 **저장 용량**

- Google Drive 무료 계정: **15GB**
- 사진 1장 평균 3MB 기준: 약 **5,000장** 저장 가능
- 용량 부족 시:
  - 오래된 사진 정리
  - Google One 구독 (100GB: 월 2,400원)

---

## ✅ **설정 완료 체크리스트**

- [ ] Google Drive 폴더 생성
- [ ] 폴더 ID 복사
- [ ] Apps Script 코드 교체
- [ ] `DRIVE_FOLDER_ID` 입력
- [ ] `ADMIN_EMAIL` 확인
- [ ] 저장 완료
- [ ] 재배포 (또는 업데이트)
- [ ] testPhotoForm() 실행
- [ ] Google Drive에 테스트 이미지 확인
- [ ] 이메일에 링크 확인
- [ ] 웹사이트에서 실제 사진 업로드 테스트
- [ ] 모든 확인 완료! 🎉

---

## 🎉 **완료!**

이제 고객이 업로드한 사진을:
- ✅ Google Drive에 자동 저장
- ✅ 이메일로 링크 수신
- ✅ 클릭 한 번에 사진 확인
- ✅ 전문적인 상담 가능

**고객 만족도가 크게 향상될 것입니다!** 📸✨

---

© 2024 솔라코어 (Solacore). All rights reserved.
